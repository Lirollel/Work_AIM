Цель – ежедневный отчёт, содержащий данные о свободной ликвидности российского периметра группы, отдельно для ЕХ и отдельно для СУЭК. Пример – во вложении.

Источники:
1)	Данные по остаткам содержатся и ежедневно обновляются вот здесь:
"RISKACCESS"."bankAccountsBalanceDaily"
Дата - "reportDate"
Отбираем по фильтру:
“accountStatus” = ‘active’
“bankCountryCode” = ‘RU’
Суммируем по полю “balanceUsd”
                Отдельно по “holding” = ‘SUEK’ и отдельно по “holding” = ‘EUROCHEM’
                Получившаяся сумма – это поле cash в итоговом отчёте.
2)	Данные по овердрафтам лежат здесь:
"RISKACCESS"."sapPositionArrears" 
где "productType"  = 130
дата отчёта – “reportDate"
там всегда висит что-то на SUEK AG – эту строку пропускаем
для СУЭК там будет АО СУЭК (companyCode = 1100)
для Еврохима – МХК Еврохим (companyCode = E200)
нас интересует разница между лимитом (15 000 000 000 для АО СУЭК и 8 000 000 000 для МХК Еврохим) и значением из поля bookValuePositionCurrency. Разницу нужно пересчитать из рублей в доллары по курсу на дату отчёта.
Результат – поле overdraft в итоговом отчёте.
Если в отчётную дату в sapPositionArrears ничего не нашлось, значит поле overdraft равно лимиту.
3)	Поле Total – сумма cash и overdraft
4)	Early trigger и threshold – константы.

Задача минимум – формировать файлики из приложенных писем.

Задача со звёздочкой – повторять само письмо, т.е. вставлять туда обновлённый график и обновлённый файл.

Дополнительно надо создать в произвольной форме дата кволити чеки:
1)	Пропавшие счета (если на предпоследнюю дату есть такая комбинация buCode, bankId, accountCurrency, accountNumber, которая не встречается в данных на последнюю дату).
2)	Новые счета (если на последнюю дату есть такая комбинация buCode, bankId, accountCurrency, accountNumber, которая не встречалась в данных за 10 последних дат)
3)	Если для бизнес-единицы в bankAccountsBalanceDaily проставлен холдинг, отличающийся от мэппинга в SalesUnits.
4)	Если появилась бизнес-единица, которой не нашлось соответствия в SalesUnits.

Best regards,
Maksim Tarakanov

Whatsapp: +7 915 161 29 12
Financial risk management

